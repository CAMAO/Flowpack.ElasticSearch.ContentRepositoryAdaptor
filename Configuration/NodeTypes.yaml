
'TYPO3.Neos:Node': &node
  properties:

    '__persistenceObjectIdentifier':
      elasticSearch:
        mapping:
          type: string
          index: not_analyzed
        indexing: ${persistenceObjectIdentifier}

    '__identifier':
      elasticSearch:
        mapping:
          type: string
          index: not_analyzed
        indexing: ${node.getIdentifier()}

    '__workspace':
      elasticSearch:
        mapping:
          type: string
          index: not_analyzed
        indexing: ${node.getWorkspace().getName()}

    '__path':
      elasticSearch:
        mapping:
          type: string
          index: not_analyzed
        indexing: ${node.getPath()}

    '__parentPath':
      elasticSearch:
        mapping:
          type: string
          index: not_analyzed
        # we index *all* parent paths as separate tokens to allow for efficient searching without a prefix query
        indexing: ${ElasticSearch.buildAllPathPrefixes(node.getParentPath())}

    '__sortIndex':
      elasticSearch:
        mapping:
          type: integer
        indexing: ${node.getIndex()}

    '_removed':
      elasticSearch:
        mapping: '' # deliberately don't map or index this
        indexing: ''

    # we index the node type INCLUDING ALL SUPERTYPES
    '__typeAndSupertypes':
      elasticSearch:
        mapping:
          type: string
          index: not_analyzed
        indexing: ${ElasticSearch.extractNodeTypeNamesAndSupertypes(node.getNodeType())}

'unstructured': *node

'TYPO3.Neos:Hidable':
  properties:
    '_hidden':
      elasticSearch:
        indexing: ${node.isHidden()}

'TYPO3.Neos:Timable':
  properties:
    '_hiddenBeforeDateTime':
      elasticSearch:
        indexing: ${node.hiddenBeforeDateTime.format('c')}

    '_hiddenAfterDateTime':
      elasticSearch:
        indexing: ${node.hiddenAfterDateTime.format('c')}


'TYPO3.Neos:Document':
  elasticSearch:
    isFulltextRoot: true
  properties:
    '__fulltextParts':
      elasticSearch:
        mapping:
          type: object
          include_in_all: false
          enabled: false

    '__fulltext':
      elasticSearch:
        mapping:
          type: object
          properties:
            'h1':
              type: string
              include_in_all: true
              boost: 20
            'h2':
              type: string
              include_in_all: true
              boost: 12
            'h3':
              type: string
              include_in_all: true
              boost: 10
            'h4':
              type: string
              include_in_all: true
              boost: 5
            'h5':
              type: string
              include_in_all: true
              boost: 3
            'h6':
              type: string
              include_in_all: true
              boost: 2
            'text':
              type: string
              include_in_all: true
              boost: 1

'TYPO3.Neos.NodeTypes:Text':
  properties:
    'text':
      elasticSearch:
        fulltextExtractor: ${ElasticSearch.fulltext.extractHtmlTags(value)}

'TYPO3.Neos.NodeTypes:Headline':
  properties:
    'title':
      elasticSearch:
        fulltextExtractor: ${ElasticSearch.fulltext.extractHtmlTags(value)}
